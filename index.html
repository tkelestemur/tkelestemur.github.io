<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Analytics (GA4) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PWH1M7QYBM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);} 
        gtag('js', new Date());
        gtag('config', 'G-PWH1M7QYBM');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Tarik Kelestemur — Applied Scientist. Publications, research, and projects in robotics and AI.">
    <title>Tarik Kelestemur — Applied Scientist</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600&family=Inter:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
</head>
<body>
    <div class="page">
        <aside class="terminal-nav">
            <div class="nav-brand">
                <span class="prompt">tarik@kelestemur</span>
                <span class="cursor">~</span>
            </div>
            <nav class="nav-menu">
                <button type="button" class="nav-item" data-target="about"><span class="token">01</span> about</button>
                <button type="button" class="nav-item" data-target="news"><span class="token">02</span> news</button>
                <button type="button" class="nav-item" data-target="publications"><span class="token">03</span> publications</button>
            </nav>
            <div class="contact-panel">
                <h2 class="contact-heading">contact</h2>
                <ul class="contact-list">
                    <li>
                        <a class="contact-icon" href="https://github.com/tkelestemur" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
                            <i class="fa-brands fa-github"></i>
                            <span class="sr-only">GitHub</span>
                        </a>
                    </li>
                    <li>
                        <a class="contact-icon" href="https://linkedin.com/in/kelestemur" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
                            <i class="fa-brands fa-linkedin-in"></i>
                            <span class="sr-only">LinkedIn</span>
                        </a>
                    </li>
                    <li>
                        <a class="contact-icon" href="https://scholar.google.com/citations?user=svxVZpoAAAAJ" target="_blank" rel="noopener noreferrer" aria-label="Google Scholar">
                            <i class="fa-solid fa-graduation-cap"></i>
                            <span class="sr-only">Google Scholar</span>
                        </a>
                    </li>
                    <li>
                        <a class="contact-icon" href="https://twitter.com/tarikkelestemur" target="_blank" rel="noopener noreferrer" aria-label="Twitter">
                            <i class="fa-brands fa-x-twitter"></i>
                            <span class="sr-only">Twitter</span>
                        </a>
                    </li>
                    <li>
                        <a class="contact-icon" href="mailto:tarik@kelestemur.com" aria-label="Email">
                            <i class="fa-solid fa-envelope"></i>
                            <span class="sr-only">Email</span>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>

        <main class="terminal-main">
            <section id="about" class="terminal-section">
                <div class="about-wrap">
                    <div class="profile-photo">
                        <img src="tarik.jpg" alt="Tarik Kelestemur">
                    </div>
                    <div class="about-body">
                        <h1>Tarik Kelestemur</h1>
                        <div class="bio"></div>
                    </div>
                </div>
            </section>

            <section id="news" class="terminal-section">
                <h2>News</h2>
                <div id="news-container" class="news-feed">
                    <div class="loading-indicator">loading log…</div>
                </div>
            </section>

            <section id="publications" class="terminal-section">
                <h2>Publications</h2>
                <div id="publications-container" class="publication-feed">
                    <div class="loading-indicator">loading publications…</div>
                </div>
            </section>
        </main>
    </div>

    <script>
        function parsePapersMarkdown(md) {
            const sections = md.split(/\n-{3,}\n/g);
            const papers = [];
            sections.forEach(section => {
                const lines = section.split('\n').map(l => l.trim()).filter(Boolean);
                if (lines.length === 0) return;
                const paper = { authors: [] };
                for (const line of lines) {
                    if (/^#{1,6}\s+/.test(line)) {
                        paper.title = line.replace(/^#{1,6}\s+/, '').trim();
                        continue;
                    }
                    const idx = line.indexOf(':');
                    if (idx === -1) continue;
                    const key = line.slice(0, idx).trim().toLowerCase();
                    const value = line.slice(idx + 1).trim();
                    switch (key) {
                        case 'authors':
                            paper.authors = value.split(',').map(a => a.trim()).filter(Boolean);
                            break;
                        case 'venue':
                            paper.venue = value;
                            break;
                        case 'pdf':
                            paper.url = value;
                            break;
                        case 'code':
                            paper.code_url = value;
                            break;
                        case 'video':
                            paper.video_url = value;
                            break;
                        case 'website':
                            paper.website_url = value;
                            break;
                        case 'scholar':
                            paper.scholar_url = value;
                            break;
                        case 'note':
                            paper.note = value;
                            break;
                        case 'figure':
                            paper.figure = value;
                            break;
                        default:
                            break;
                    }
                }
                if (paper.title) papers.push(paper);
            });
            return papers;
        }

        function createPublicationFigure(paper) {
            if (!paper.figure) return null;
            const container = document.createElement('div');
            container.className = 'publication-figure';

            const figurePath = paper.figure.split(/[?#]/)[0];
            const ext = figurePath.split('.').pop().toLowerCase();

            if (ext === 'mp4') {
                const video = document.createElement('video');
                video.src = paper.figure;
                video.loop = true;
                video.muted = true;
                video.autoplay = true;
                video.playsInline = true;
                video.setAttribute('poster', 'images/default-paper-thumbnail.jpg');
                video.setAttribute('aria-label', `${paper.title || 'Publication'} clip`);
                container.appendChild(video);
            } else {
                const img = document.createElement('img');
                img.src = paper.figure;
                img.alt = paper.title ? `${paper.title} figure` : 'Publication figure';
                img.loading = 'lazy';
                img.decoding = 'async';
                img.onerror = () => {
                    img.src = 'images/default-paper-thumbnail.jpg';
                };
                container.appendChild(img);
            }

            return container;
        }

        async function loadIntroMarkdown() {
            try {
                const el = document.querySelector('.bio');
                if (!el) return;
                const res = await fetch('intro.md?cb=' + Date.now());
                if (!res.ok) throw new Error('Failed to load intro.md');
                const md = await res.text();
                if (window.marked) {
                    el.innerHTML = marked.parse(md);
                } else {
                    el.textContent = md;
                }
            } catch (err) {
                console.error('Failed to load intro:', err);
            }
        }

        async function loadNewsMarkdown() {
            try {
                const container = document.getElementById('news-container');
                if (!container) return;
                const res = await fetch('news.md?cb=' + Date.now());
                if (!res.ok) throw new Error('Failed to load news.md');
                const md = await res.text();
                const lines = md.split(/\r?\n/).map(line => line.trim()).filter(Boolean);
                if (!lines.length) {
                    container.innerHTML = '<p class="empty-state">No updates yet.</p>';
                    return;
                }
                const latest = lines.slice(-5).reverse();
                const list = document.createElement('ul');
                list.className = 'news-list';
                latest.forEach(entry => {
                    const item = document.createElement('li');
                    item.className = 'news-item';
                    if (window.marked && window.marked.parseInline) {
                        item.innerHTML = marked.parseInline(entry);
                    } else {
                        item.textContent = entry;
                    }
                    list.appendChild(item);
                });
                container.innerHTML = '';
                container.appendChild(list);
            } catch (err) {
                console.error('Failed to load news:', err);
                const container = document.getElementById('news-container');
                if (container) {
                    container.innerHTML = `<p class="error-state">Error loading news: ${err.message}</p>`;
                }
            }
        }

        async function loadPapersFromMarkdown() {
            try {
                const container = document.getElementById('publications-container');
                if (!container) throw new Error('Could not find publications-container element');

                const response = await fetch('papers.md?cb=' + Date.now());
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const mdText = await response.text();
                const papers = parsePapersMarkdown(mdText);

                container.innerHTML = '';

                if (!papers.length) {
                    container.innerHTML = '<p class="empty-state">No publications found.</p>';
                    return;
                }

                const list = document.createElement('div');
                list.className = 'publications-list';

                papers.forEach(paper => {
                    const paperElement = document.createElement('article');
                    paperElement.className = 'publication';

                    const body = document.createElement('div');
                    body.className = 'publication-body';

                    const figure = createPublicationFigure(paper);
                    if (figure) {
                        body.appendChild(figure);
                    }

                    const content = document.createElement('div');
                    content.className = 'publication-content';

                    const header = document.createElement('header');
                    header.className = 'publication-header';

                    const title = document.createElement('h3');
                    title.textContent = paper.title || '';
                    header.appendChild(title);

                    if (paper.authors && paper.authors.length) {
                        const authors = document.createElement('p');
                        authors.className = 'authors';
                        authors.textContent = paper.authors.join(', ');
                        header.appendChild(authors);
                    }

                    if (paper.venue) {
                        const venue = document.createElement('p');
                        venue.className = 'venue';
                        venue.textContent = paper.venue;
                        header.appendChild(venue);
                    }

                    content.appendChild(header);

                    if (paper.note) {
                        const note = document.createElement('p');
                        note.className = 'note';
                        note.textContent = paper.note;
                        content.appendChild(note);
                    }

                    const links = [];
                    if (paper.url) links.push({ label: 'pdf', url: paper.url });
                    if (paper.code_url) links.push({ label: 'code', url: paper.code_url });
                    if (paper.video_url) links.push({ label: 'video', url: paper.video_url });
                    if (paper.website_url) links.push({ label: 'site', url: paper.website_url });
                    if (paper.scholar_url) links.push({ label: 'scholar', url: paper.scholar_url });

                    if (links.length) {
                        const linksList = document.createElement('div');
                        linksList.className = 'pub-links';
                        links.forEach(link => {
                            const a = document.createElement('a');
                            a.href = link.url;
                            a.textContent = link.label;
                            a.target = '_blank';
                            a.rel = 'noopener noreferrer';
                            linksList.appendChild(a);
                        });
                        content.appendChild(linksList);
                    }

                    body.appendChild(content);
                    paperElement.appendChild(body);
                    list.appendChild(paperElement);
                });

                container.appendChild(list);
            } catch (error) {
                console.error('Detailed error:', error);
                const container = document.getElementById('publications-container');
                if (container) {
                    container.innerHTML = `<p class="error-state">Error loading publications: ${error.message}</p>`;
                }
            }
        }

        function initNavigation() {
            const navItems = Array.from(document.querySelectorAll('.nav-item'));
            const sections = Array.from(document.querySelectorAll('.terminal-section'));
            if (!navItems.length || !sections.length) return;

            const sectionMap = new Map(sections.map(section => [section.id, section]));
            const sectionVisibility = new Map();

            const setActiveNav = (targetId) => {
                navItems.forEach(item => {
                    const match = item.getAttribute('data-target') === targetId;
                    item.classList.toggle('active', match);
                });
            };

            navItems.forEach(item => {
                const target = item.getAttribute('data-target');
                const section = sectionMap.get(target);
                if (!section) return;
                item.addEventListener('click', () => {
                    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    setActiveNav(target);
                });
            });

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const id = entry.target.id;
                    const ratio = entry.isIntersecting ? entry.intersectionRatio : 0;
                    sectionVisibility.set(id, ratio);
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });

                let currentId = sections[0].id;
                let maxRatio = 0;
                sectionVisibility.forEach((ratio, id) => {
                    if (ratio > maxRatio) {
                        maxRatio = ratio;
                        currentId = id;
                    }
                });

                setActiveNav(currentId);
            }, {
                threshold: [0.2, 0.35, 0.5, 0.65],
            });

            sections.forEach((section, index) => {
                sectionVisibility.set(section.id, index === 0 ? 1 : 0);
                if (index === 0) {
                    section.classList.add('visible');
                }
                observer.observe(section);
            });

            setActiveNav(sections[0].id);
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadIntroMarkdown();
            loadNewsMarkdown();
            loadPapersFromMarkdown();
            initNavigation();
        });
    </script>
</body>
</html>
